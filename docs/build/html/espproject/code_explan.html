<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1.2 How ws_test.py Works? &mdash; SunFounder Euler Kit for Raspberry Pi Pico 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://ezblock.cc/readDocFile/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="https://ezblock.cc/readDocFile/custom.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1.3 What Data is Transferred between APP &amp; Picoï¼Ÿ" href="transfer_data.html" />
    <link rel="prev" title="1.1 First-time Use the APP" href="esp_basic_function.html" /> 
</head>

<body class="wy-body-for-nav">
<nav id="nav-bar">
  <ul class="nav-bar-items" id="nav-bar-items">
    <li class="nav-bar-logo">
      <a href="https://sunfounder.com">
        <img class="logo-img" src="https://ezblock.cc/readDocFile/sunfounder_LOGO_160x@2x.png"/>
      </a>
    </li>
  </ul>
</nav>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SunFounder Euler Kit for Raspberry Pi Pico
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction_to_raspberry_pi_pico.html">Introduction to Raspberry Pi Pico</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download_the_code.html">Download the Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bc_basic_circuit.html">Electronic Circuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyproject/for_micropython_user.html">For MicroPython User</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="for_esp8266_user.html">Play Pico with APP</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="esp_basic_function.html">1.1 First-time Use the APP</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.2 How <code class="docutils literal notranslate"><span class="pre">ws_test.py</span></code> Works?</a></li>
<li class="toctree-l2"><a class="reference internal" href="transfer_data.html">1.3 What Data is Transferred between APP &amp; Picoï¼Ÿ</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp_input.html">1.4 APP Display Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp_output.html">1.5 APP Actuator Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp_piano.html">1.6 Electronic Piano</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp_plant_monitor.html">1.7 Plant Monitor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cproject/for_arduino_user.html">For Arduino User</a></li>
<li class="toctree-l1"><a class="reference internal" href="../piperproject/for_piper.html">For Piper Make</a></li>
<li class="toctree-l1"><a class="reference internal" href="../component/what_is_included_in_this_kit.html">What is Included in This Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SunFounder Euler Kit for Raspberry Pi Pico</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="for_esp8266_user.html">Play Pico with APP</a></li>
      <li class="breadcrumb-item active">1.2 How <code class="docutils literal notranslate"><span class="pre">ws_test.py</span></code> Works?</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/espproject/code_explan.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hello, welcome to the SunFounder Raspberry Pi &amp; Arduino &amp; ESP32 Enthusiasts Community on Facebook! Dive deeper into Raspberry Pi, Arduino, and ESP32 with fellow enthusiasts.</p>
<p><strong>Why Join?</strong></p>
<ul class="simple">
<li><p><strong>Expert Support</strong>: Solve post-sale issues and technical challenges with help from our community and team.</p></li>
<li><p><strong>Learn &amp; Share</strong>: Exchange tips and tutorials to enhance your skills.</p></li>
<li><p><strong>Exclusive Previews</strong>: Get early access to new product announcements and sneak peeks.</p></li>
<li><p><strong>Special Discounts</strong>: Enjoy exclusive discounts on our newest products.</p></li>
<li><p><strong>Festive Promotions and Giveaways</strong>: Take part in giveaways and holiday promotions.</p></li>
</ul>
<p>ðŸ‘‰ Ready to explore and create with us? Click [<a href="https://bit.ly/raphaelkit" target="_blank">here</a>] and join today!</p>
</div>
<section id="how-ws-test-py-works">
<h1>1.2 How <code class="docutils literal notranslate"><span class="pre">ws_test.py</span></code> Works?<a class="headerlink" href="#how-ws-test-py-works" title="Permalink to this heading">Â¶</a></h1>
<p>The communication between Pico and Sunfounder Controller is based on the <code class="docutils literal notranslate"><span class="pre">websocket</span> <span class="pre">protocol</span></code>.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/WebSocket">WebSocket - Wikipedia</a></p></li>
</ul>
<p>The specific workflow of APP Control gameplay is as follows:</p>
<blockquote>
<div><p><img alt="flowchart_app_control" src="../_images/flowchart_app_control.png" /></p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ws</span> <span class="kn">import</span> <span class="n">WS_Server</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_esp8266&#39;</span>

<span class="c1">## Client Mode</span>
<span class="c1"># WIFI_MODE = &quot;sta&quot;</span>
<span class="c1"># SSID = &quot;YOUR SSID HERE&quot;</span>
<span class="c1"># PASSWORD = &quot;YOUR PASSWORD HERE&quot;</span>

<span class="c1">## AP Mode</span>
<span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
<span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>


<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">led</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">PWM</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
<span class="n">led</span><span class="o">.</span><span class="n">freq</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">potentiometer</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">ADC</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># output</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
    <span class="n">led</span><span class="o">.</span><span class="n">duty_u16</span><span class="p">(</span><span class="n">value</span><span class="o">*</span><span class="mi">655</span><span class="p">)</span>

    <span class="c1"># input</span>
    <span class="n">value</span><span class="o">=</span><span class="n">potentiometer</span><span class="o">.</span><span class="n">read_u16</span><span class="p">()</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>

<span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>This code constitutes the basic framework of APP control. Here, you need to pay attention to the following two parts:</p>
<ol class="arabic">
<li><p>Setup websocket</p>
<blockquote>
<div><p>There are two connection mode between Sunfounder Controller and Pico: One is <strong>AP</strong> mode, the other is <strong>STA</strong> mode.</p>
<ul class="simple">
<li><p><strong>AP Mode</strong>: You need to connect Sunfounder Contorller to the hotspot released by pico.</p></li>
<li><p><strong>STA Mode</strong>: You need to connect Sunfounder Controller and pico to the same LAN.</p></li>
</ul>
<p>The default connection mode is <strong>AP Mode</strong>: The Pico releases the hotspot (the Wifi name is <code class="docutils literal notranslate"><span class="pre">NAME</span></code> in the code, here is <code class="docutils literal notranslate"><span class="pre">my_esp8266</span></code>), the mobile phone (tablet) is connected to this WLAN.
This mode allows you to remotely control pico in any situation, but will make your phone (tablet) temporarily unable to connect to the Internet.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_esp8266&#39;</span>

<span class="hll"><span class="c1">## Client Mode</span>
</span><span class="hll"><span class="c1"># WIFI_MODE = &quot;sta&quot;</span>
</span><span class="hll"><span class="c1"># SSID = &quot;YOUR SSID HERE&quot;</span>
</span><span class="hll"><span class="c1"># PASSWORD = &quot;YOUR PASSWORD HERE&quot;</span>
</span>
<span class="hll"><span class="c1">## AP Mode</span>
</span><span class="hll"><span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;ap&quot;</span>
</span><span class="hll"><span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class="hll"><span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;12345678&quot;</span>
</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also use <strong>STA</strong> mode: Let the pico connects to your home WLAN, and your mobile phone (tablet) should also be connected to the same WLAN.</p>
<p>This mode is opposite to the <strong>AP</strong> mode and will not affect the normal use of the mobile phone (tablet), but will limit your pico from leaving the WLAN radiation range.</p>
<p>The way to start this mode is to comment out the three lines under <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">AP</span> <span class="pre">Mode</span></code>, uncomment the three lines under <code class="docutils literal notranslate"><span class="pre">##</span> <span class="pre">Client</span> <span class="pre">Mode</span></code>, and change the <code class="docutils literal notranslate"><span class="pre">SSID</span></code> and <code class="docutils literal notranslate"><span class="pre">PASSWORD</span></code> to your home WIFI at the same time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;my_esp8266&#39;</span>

<span class="hll"><span class="c1">## Client Mode</span>
</span><span class="hll"><span class="n">WIFI_MODE</span> <span class="o">=</span> <span class="s2">&quot;sta&quot;</span>
</span><span class="hll"><span class="n">SSID</span> <span class="o">=</span> <span class="s2">&quot;YOUR SSID HERE&quot;</span>
</span><span class="hll"><span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;YOUR PASSWORD HERE&quot;</span>
</span>
<span class="hll"><span class="c1">## AP Mode</span>
</span><span class="hll"><span class="c1"># WIFI_MODE = &quot;ap&quot;</span>
</span><span class="hll"><span class="c1"># SSID = &quot;&quot;</span>
</span><span class="hll"><span class="c1"># PASSWORD = &quot;12345678&quot;</span>
</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>After completing the connection mode settings, Websocket will set up and start the server.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">WS_Server</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">NAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">WIFI_MODE</span><span class="p">,</span> <span class="n">ssid</span><span class="o">=</span><span class="n">SSID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Responding</p>
<blockquote>
<div><p>The specific operation code of Pico and Sunfounder Controller is written on the <code class="docutils literal notranslate"><span class="pre">on_receive()</span></code> function. Usually, we need to write the codes for APP to control Pico on the front and the codes for APP to show Pico sensor data on the back.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">on_receive</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># output</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
    <span class="n">led</span><span class="o">.</span><span class="n">duty_u16</span><span class="p">(</span><span class="n">value</span><span class="o">*</span><span class="mi">655</span><span class="p">)</span>

    <span class="c1"># input</span>
    <span class="n">value</span><span class="o">=</span><span class="n">potentiometer</span><span class="o">.</span><span class="n">read_u16</span><span class="p">()</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">send_dict</span><span class="p">[</span><span class="s1">&#39;G&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="n">ws</span><span class="o">.</span><span class="n">on_receive</span> <span class="o">=</span> <span class="n">on_receive</span>
</pre></div>
</div>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">on_receive()</span></code> will be assigned to <code class="docutils literal notranslate"><span class="pre">ws.on_receive</span></code> and then called by <code class="docutils literal notranslate"><span class="pre">ws.loop</span></code>.</p>
</div></blockquote>
</li>
</ol>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="esp_basic_function.html" class="btn btn-neutral float-left" title="1.1 First-time Use the APP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="transfer_data.html" class="btn btn-neutral float-right" title="1.3 What Data is Transferred between APP &amp; Picoï¼Ÿ" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, SunFounder.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>